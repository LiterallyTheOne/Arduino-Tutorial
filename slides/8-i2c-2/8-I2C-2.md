---
marp: true
theme: uncover
footer: By Ramin Zarebidoky (LiterallyTheOne)
header: "Arduino Tutorial, I2C: Part 2"
size: 16:9
---


<style scoped>
p {
  color: cyan;
}
</style>

<!-- _header: "" -->
<!-- _footer: "" -->

# Arduino Tutorial

By LiterallyTheOne

## 8: I2C: Part 2

![bg right:33% w:400](qr-code-1.webp)

---
<!-- paginate: true -->

## Introduction

* Previous tutorial: I2C part 1
* This tutorial: I2C part 2

![bg right:33% w:400](../../docs/7-i2c-1/oled-ball.gif)

---

## DS1621

* Measures Temperature
  * $[-55C, 125C]$
  * $0.5$ resolution
* I2C

![temperature ds1621](../../docs/8-i2c-2/temperature-ds1621.webp)

---

## DS1621: Connect to Arduino

* **DS1621**: **Micro/Sensors/DS1621**

![h:420](../../docs/8-i2c-2/temperature-setup.webp)

---

## DS1621: Find the ID

* With the scan code

```cpp
#define DS1621_ADDRESS 0x48
```

---

## DS1621: Command table

![h:450 w:800](../../docs/8-i2c-2/command-table.webp)

---

## DS1621: Initiate conversation

```cpp
Wire.beginTransmission(DS1621_ADDRESS);
Wire.write(0xEE);
Wire.endTransmission();
```

---

## DS1621: Remove 1shot

![w:800](../../docs/8-i2c-2/register-configuration.webp)

```cpp
Wire.beginTransmission(DS1621_ADDRESS);
Wire.write(0xAC);
Wire.write(0x00);
Wire.endTransmission();
```

---

## DS1621: Request Read

```cpp
Wire.beginTransmission(DS1621_ADDRESS);
Wire.write(0xAA);
Wire.endTransmission();
```

---

## DS1621: Read 2 bytes

```cpp
Wire.requestFrom(DS1621_ADDRESS, 2);
byte temp_msb = Wire.read();
byte temp_lsb = Wire.read();
```

---

## DS1621: Storage method

![w:1200](../../docs/8-i2c-2/output-of-temperature.webp)

---

## DS1621: Convert those two bytes

```cpp
float result = temp_msb;
if (temp_lsb & 0x80)
{
  result += 0.5;
}
```

---

## DS1621: result

![h:450](../../docs/8-i2c-2/temperature-output-gif.gif)

---

## Arduino slave

* We can configure an Arduino as a slave

---

## Connect the second Arduino

![bg right:66% h:600](../../docs/8-i2c-2/arudino-slave-temperature.webp)

---

## Initialize the second Arduino

```cpp
Wire.begin(8);
```

## OnReceive

* Works as an interrupt

```cpp
Wire.onReceive(receiveEvent);
```

---

## Get all the data and set a flag

```cpp
String result;
bool i2c_ready = false;

void receiveEvent(int howMany)
{
  i2c_ready = true;
  result = "";
  while (Wire.available())
  {
    char c = Wire.read();
    result += c;
  }
}
```

---

## Write the data in the Serial Terminal

```cpp
if (i2c_ready)
{
  i2c_ready = false;
  Serial.println(result);
}
```

---

## Send data from Master

```cpp
#define ARDUINO_2 0x08
```

```cpp
String str_temp = String(temperature);

Wire.beginTransmission(ARDUINO_2);
for (unsigned int i = 0; i < str_temp.length(); i++)
{
  Wire.write(str_temp[i]);
}
Wire.endTransmission();
```

---

## Output of 2 Arduinos

![h:450](../../docs/8-i2c-2/arudino-slave-temperature-gif.gif)

---

## OnRequest

* Triggers when a request happens

```cpp
Wire.onRequest(requestEvent);
```

---

## Write two bytes

```cpp
void requestEvent()
{
    Wire.write(5);
    Wire.write(6);
}
```

---

## Receive data from Master

```cpp
Wire.requestFrom(ARDUINO_2, 2);
String received_data = "";
received_data += Wire.read();
received_data += Wire.read();
```

---

## Small detail about Wire

* `onReceive` gets triggered on both
  * Getting data
  * Sending data
* At the beginning of the function

```cpp
if (howMany == 0)
    return;
```

---

## Output of receiving and sending

![h:450](../../docs/8-i2c-2/arduino-slave-temperature-request-gif.gif)

---

## Link to the tutorial and materials

![w:400](qr-code-1.webp)
